<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Mesut Tekno Market - Teknoloji √úr√ºnleri</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <!-- (Sayfa i√ßeriƒüi aynƒ±, ba≈ü kƒ±sƒ±mlarƒ±nƒ±zƒ± korudum) -->
  <!-- Top Bar, Header, Mobile Menu, Categories, Login Modal, Admin Panel, Products, Footer -->
  <!-- ... (sizin mevcut HTML yapƒ±nƒ±zƒ±n aynƒ±sƒ±, yalnƒ±zca script kƒ±smƒ± g√ºncellendi) ... -->

  <!-- Kƒ±saltmak i√ßin HTML sabit kƒ±smƒ±nƒ±zƒ± yukarƒ±daki g√∂nderidekiyle birebir kullanabilirsiniz. -->
  <!-- A≈üaƒüƒ±da script kƒ±smƒ± Firebase entegrasyonu i√ßin g√ºncellenmi≈ü haliyle geliyor. -->

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    // --- DEFAULT PRODUCTS (ilk ba≈ülangƒ±√ß i√ßin collection bo≈üsa eklemek √ºzere) ---
    const DEFAULT_PRODUCTS = [
      { id: 1, name: 'iPhone 15 Pro', description: '256GB, Titanium', imageUrl: 'https://images.unsplash.com/photo-1696446702883-ba4e6d7e7d42?w=400', price: 45000, originalPrice: 55000, category: 'Telefon', stock: 15 },
      { id: 2, name: 'Samsung Galaxy S24 Ultra', description: '512GB, Phantom Black', imageUrl: 'https://images.unsplash.com/photo-1610945415295-d9bbf067e59c?w=400', price: 42000, originalPrice: 50000, category: 'Telefon', stock: 20 },
      { id: 3, name: 'MacBook Pro M3', description: '16GB RAM, 512GB SSD', imageUrl: 'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=400', price: 65000, originalPrice: 75000, category: 'Laptop', stock: 8 },
      { id: 4, name: 'Dell XPS 15', description: '32GB RAM, 1TB SSD', imageUrl: 'https://images.unsplash.com/photo-1593642632823-8f785ba67e45?w=400', price: 48000, originalPrice: 48000, category: 'Laptop', stock: 12 },
      { id: 5, name: 'iPad Pro 12.9\"', description: 'M2 Chip, 256GB', imageUrl: 'https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=400', price: 38000, originalPrice: 45000, category: 'Tablet', stock: 10 },
      { id: 6, name: 'Samsung Galaxy Tab S9', description: '128GB, Wi-Fi', imageUrl: 'https://images.unsplash.com/photo-1561154464-82e9adf32764?w=400', price: 22000, originalPrice: 22000, category: 'Tablet', stock: 15 },
      { id: 7, name: 'AirPods Pro 2', description: 'Aktif G√ºr√ºlt√º √ñnleme', imageUrl: 'https://images.unsplash.com/photo-1606841837239-c5a1a4a07af7?w=400', price: 8500, originalPrice: 10000, category: 'Aksesuar', stock: 30 },
      { id: 8, name: 'Apple Watch Series 9', description: '45mm, GPS + Cellular', imageUrl: 'https://images.unsplash.com/photo-1434494878577-86c23bcb06b9?w=400', price: 18000, originalPrice: 18000, category: 'Aksesuar', stock: 18 }
    ];

    // --- Deƒüi≈ükenler ---
    let products = [];
    let isAdmin = false;
    let currentCategory = 'all';
    let currentPage = 1;
    let searchQuery = '';
    const PRODUCTS_PER_PAGE = 12;

    // --- FIREBASE CONFIG --- 
    // TODO: A≈üaƒüƒ±ya kendi Firebase projenizin config nesnesini yapƒ±≈ütƒ±rƒ±n.
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      // diƒüer alanlar...
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Enable offline persistence (isteƒüe baƒülƒ±)
    db.enablePersistence()
      .catch(function(err) {
      // Import the functions you need from the SDKs you need

import { initializeApp } from "firebase/app";

import { getAnalytics } from "firebase/analytics";

// TODO: Add SDKs for Firebase products that you want to use

// https://firebase.google.com/docs/web/setup#available-libraries


// Your web app's Firebase configuration

// For Firebase JS SDK v7.20.0 and later, measurementId is optional

const firebaseConfig = {

  apiKey: "AIzaSyC_Y6kRF8CZdKJwihkEaSwy1nHBFJb7OUo",

  authDomain: "mesut-tekno-market.firebaseapp.com",

  projectId: "mesut-tekno-market",

  storageBucket: "mesut-tekno-market.firebasestorage.app",

  messagingSenderId: "242014287881",

  appId: "1:242014287881:web:6200ff1d6497d2e36b60d8",

  measurementId: "G-G8K16D1ZCQ"

};


// Initialize Firebase

const app = initializeApp(firebaseConfig);

const analytics = getAnalytics(app);
      });

    // --- Veri y√ºkleme ve ger√ßek zamanlƒ± dinleme ---
    async function initializeStorage() {
      document.getElementById('loadingMessage').style.display = 'none';

      // Eƒüer collection bo≈üsa default √ºr√ºnleri y√ºkle
      const snapshot = await db.collection('products').limit(1).get();
      if (snapshot.empty) {
        // seed verisi ekle
        DEFAULT_PRODUCTS.forEach(p => {
          db.collection('products').add({
            ...p,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          }).catch(e => console.error('Seed eklerken hata', e));
        });
      }

      // Ger√ßek zamanlƒ± dinleme ‚Äî t√ºm cihazlarda anlƒ±k g√ºncelleme saƒülar
      db.collection('products').orderBy('createdAt', 'asc').onSnapshot(snap => {
        products = snap.docs.map(doc => {
          return { docId: doc.id, ...doc.data() };
        });
        // Firestore serverTimestamp bazen null geliyor; fallback i√ßin null kontrol√º yapabilirsiniz.
        render();
      }, err => {
        console.error('Snapshot hata:', err);
      });
    }

    // --- Render, Pagination, Search (mevcut mantƒ±ƒüƒ±nƒ±zƒ± korudum; k√º√ß√ºk uyarlamalar var) ---
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'fixed top-24 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-bounce';
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 2000);
    }

    function render() {
      let filtered = products.filter(p => {
        const matchesCategory = currentCategory === 'all' || p.category === currentCategory;
        const matchesSearch = searchQuery === '' ||
          (p.name && p.name.toLowerCase().includes(searchQuery.toLowerCase())) ||
          (p.description && p.description.toLowerCase().includes(searchQuery.toLowerCase()));
        return matchesCategory && matchesSearch;
      });

      const totalPages = Math.ceil(filtered.length / PRODUCTS_PER_PAGE);
      if (currentPage > totalPages && totalPages > 0) currentPage = totalPages;
      if (currentPage < 1) currentPage = 1;
      const startIndex = (currentPage - 1) * PRODUCTS_PER_PAGE;
      const pageProducts = filtered.slice(startIndex, startIndex + PRODUCTS_PER_PAGE);

      const grid = document.getElementById('productsGrid');
      const noProducts = document.getElementById('noProducts');

      if (filtered.length === 0) {
        grid.innerHTML = '';
        noProducts.classList.remove('hidden');
        document.getElementById('productCount').textContent = '';
        document.getElementById('pagination').innerHTML = '';
        return;
      }

      noProducts.classList.add('hidden');
      document.getElementById('productCount').textContent =
        `${filtered.length} √ºr√ºn bulundu${filtered.length > PRODUCTS_PER_PAGE ? ` (Sayfa ${currentPage}/${totalPages})` : ''}`;

      grid.innerHTML = pageProducts.map(p => {
        const hasDiscount = p.originalPrice > p.price;
        const discountPercent = hasDiscount ? Math.round((1 - p.price / p.originalPrice) * 100) : 0;
        const waMessage = encodeURIComponent(`Merhaba, ${p.name} √ºr√ºn√º hakkƒ±nda bilgi almak istiyorum.`);
        // docId kullanƒ±yoruz (Firestore dok√ºman id)
        const docId = p.docId;

        return `
          <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden group relative">
            ${hasDiscount ? `<div class="absolute top-3 right-3 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold z-10">-%${discountPercent}</div>` : ''}
            ${p.stock < 5 ? `<div class="absolute top-3 left-3 bg-orange-500 text-white px-3 py-1 rounded-full text-xs font-bold z-10">Son ${p.stock} adet!</div>` : ''}
            <div class="relative overflow-hidden">
              <img src="${p.imageUrl}" class="w-full h-48 object-cover group-hover:scale-110 transition-transform duration-500" alt="${p.name}">
            </div>
            <div class="p-4">
              <h3 class="font-bold text-lg mb-1 line-clamp-1">${p.name}</h3>
              <p class="text-sm text-gray-600 mb-3 line-clamp-2">${p.description || ''}</p>
              <div class="mb-3">
                ${hasDiscount ? `<p class="text-sm line-through text-gray-400">${(p.originalPrice || 0).toLocaleString()} ‚Ç∫</p>` : ''}
                <p class="text-xl font-bold text-blue-600">${(p.price || 0).toLocaleString()} ‚Ç∫</p>
              </div>
              ${isAdmin ? `
                <button onclick="deleteProduct('${docId}')" class="w-full bg-red-500 text-white py-3 rounded-xl font-semibold hover:bg-red-600 transition-all">
                  üóëÔ∏è Sil
                </button>
              ` : `
                <a href="https://wa.me/905443894007?text=${waMessage}" target="_blank" class="block w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-xl font-semibold hover:shadow-lg transition-all text-center ${p.stock === 0 ? 'opacity-50 cursor-not-allowed pointer-events-none' : ''}">
                  ${p.stock === 0 ? '‚ùå Stokta Yok' : 'üí¨ WhatsApp ile ƒ∞leti≈üim'}
                </a>
              `}
            </div>
          </div>
        `;
      }).join('');

      renderPagination(totalPages);
    }

    function renderPagination(totalPages) {
      const pagination = document.getElementById('pagination');
      if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
      }
      let html = '';
      html += `
        <button onclick="goToPage(1)" class="px-3 py-2 sm:px-4 sm:py-2 rounded-lg ${currentPage === 1 ? 'bg-gray-200 cursor-not-allowed' : 'bg-white hover:bg-gray-100 shadow'} border transition-all" ${currentPage === 1 ? 'disabled' : ''}>‚èÆÔ∏è</button>
        <button onclick="goToPage(${currentPage - 1})" class="px-3 py-2 sm:px-4 sm:py-2 rounded-lg ${currentPage === 1 ? 'bg-gray-200 cursor-not-allowed' : 'bg-white hover:bg-gray-100 shadow'} border transition-all" ${currentPage === 1 ? 'disabled' : ''}>‚óÄÔ∏è</button>
      `;
      const startPage = Math.max(1, currentPage - 1);
      const endPage = Math.min(totalPages, currentPage + 1);
      for (let i = startPage; i <= endPage; i++) {
        html += `<button onclick="goToPage(${i})" class="px-3 py-2 sm:px-4 sm:py-2 rounded-lg ${currentPage === i ? 'bg-blue-600 text-white shadow-lg' : 'bg-white hover:bg-gray-100 shadow'} border font-medium transition-all">${i}</button>`;
      }
      html += `
        <button onclick="goToPage(${currentPage + 1})" class="px-3 py-2 sm:px-4 sm:py-2 rounded-lg ${currentPage === totalPages ? 'bg-gray-200 cursor-not-allowed' : 'bg-white hover:bg-gray-100 shadow'} border transition-all" ${currentPage === totalPages ? 'disabled' : ''}>‚ñ∂Ô∏è</button>
        <button onclick="goToPage(${totalPages})" class="px-3 py-2 sm:px-4 sm:py-2 rounded-lg ${currentPage === totalPages ? 'bg-gray-200 cursor-not-allowed' : 'bg-white hover:bg-gray-100 shadow'} border transition-all" ${currentPage === totalPages ? 'disabled' : ''}>‚è≠Ô∏è</button>
      `;
      pagination.innerHTML = html;
    }

    function goToPage(page) {
      currentPage = page;
      render();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // --- Silme (Firestore dok√ºman id ile) ---
    async function deleteProduct(docId) {
      if (!isAdmin) { alert('ƒ∞ziniz yok.'); return; }
      if (!confirm('Bu √ºr√ºn√º silmek istediƒüinizden emin misiniz?')) return;
      try {
        await db.collection('products').doc(docId).delete();
        showNotification('√úr√ºn silindi! üóëÔ∏è');
      } catch (e) {
        console.error('Silme hatasƒ±', e);
        alert('Silme sƒ±rasƒ±nda hata olu≈ütu.');
      }
    }

    // --- Event Listeners (sizin orijinal koduza entegre edilmi≈ü) ---
    document.getElementById('mobileMenuBtn').addEventListener('click', () => {
      const menu = document.getElementById('mobileMenu');
      menu.classList.toggle('hidden');
    });

    document.querySelectorAll('.category-btn, .mobile-category-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const target = e.currentTarget;
        currentCategory = target.dataset.category;
        currentPage = 1;
        document.querySelectorAll('.category-btn, .mobile-category-btn').forEach(b => {
          b.classList.remove('bg-blue-600', 'text-white');
          b.classList.add('bg-white', 'hover:bg-gray-100');
        });
        target.classList.remove('bg-white', 'hover:bg-gray-100');
        target.classList.add('bg-blue-600', 'text-white');
        document.getElementById('mobileMenu').classList.add('hidden');
        render();
      });
    });

    document.getElementById('searchInput').addEventListener('input', (e) => {
      searchQuery = e.target.value;
      currentPage = 1;
      render();
    });

    document.getElementById('adminBtn').addEventListener('click', () => {
      if (isAdmin) {
        document.getElementById('adminPanel').classList.toggle('hidden');
      } else {
        document.getElementById('loginModal').classList.remove('hidden');
      }
    });

    document.getElementById('closeLoginModal').addEventListener('click', () => {
      document.getElementById('loginModal').classList.add('hidden');
    });

    document.getElementById('loginBtn').addEventListener('click', () => {
      const password = document.getElementById('passwordInput').value;
      if (password === 'yunus710') {
        isAdmin = true;
        document.getElementById('loginModal').classList.add('hidden');
        document.getElementById('adminPanel').classList.remove('hidden');
        showNotification('Admin giri≈üi ba≈üarƒ±lƒ±! üë§');
        render();
      } else {
        alert('Hatalƒ± ≈üifre!');
      }
    });

    document.getElementById('logoutBtn').addEventListener('click', () => {
      isAdmin = false;
      document.getElementById('adminPanel').classList.add('hidden');
      showNotification('√áƒ±kƒ±≈ü yapƒ±ldƒ±! üëã');
      render();
    });

    document.getElementById('addProductBtn').addEventListener('click', async () => {
      if (!isAdmin) { alert('√ñnce admin olarak giri≈ü yapƒ±n.'); return; }
      const name = document.getElementById('productName').value;
      const desc = document.getElementById('productDesc').value;
      const category = document.getElementById('productCategory').value;
      const image = document.getElementById('productImage').value;
      const price = parseFloat(document.getElementById('productPrice').value);
      const originalPrice = parseFloat(document.getElementById('productOriginalPrice').value) || price;
      const stock = parseInt(document.getElementById('productStock').value) || 10;

      if (!name || !image || !price) {
        alert('L√ºtfen zorunlu alanlarƒ± doldurun! (ƒ∞sim, G√∂rsel, Fiyat)');
        return;
      }

      const newProduct = {
        id: Date.now(),
        name,
        description: desc,
        category,
        imageUrl: image,
        price,
        originalPrice,
        stock,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      };

      try {
        await db.collection('products').add(newProduct);
        showNotification('√úr√ºn eklendi! ‚úÖ');
        // formu temizle
        document.getElementById('productName').value = '';
        document.getElementById('productDesc').value = '';
        document.getElementById('productImage').value = '';
        document.getElementById('productPrice').value = '';
        document.getElementById('productOriginalPrice').value = '';
        document.getElementById('productStock').value = '10';
      } catch (e) {
        console.error('Ekleme hatasƒ±', e);
        alert('√úr√ºn eklenirken hata oldu.');
      }
    });

    // Ba≈ülat
    initializeStorage();
  </script>
</body>
</html>
